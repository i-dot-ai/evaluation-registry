window.GOVUK=window.GOVUK||{};window.GOVUK.Modules=window.GOVUK.Modules||{};(function(s){function n(o){this.$optionSelect=o,this.$options=this.$optionSelect.querySelectorAll("input[type='checkbox']"),this.$optionsContainer=this.$optionSelect.querySelector(".autofilter-option-select__container"),this.$optionList=this.$optionsContainer.querySelector(".js-auto-height-inner"),this.$allCheckboxes=this.$optionsContainer.querySelectorAll(".govuk-checkboxes__item"),this.filterLabel=this.$optionSelect.getAttribute("data-filter-element")||"",this.checkedCheckboxes=[]}n.prototype.init=function(){if(this.filterLabel.length){var o=document.createElement("div"),e=document.createElement("label");e.for=`input-${this.filterLabel}`,e.classList=["govuk-label govuk-visually-hidden"],e.textContent=this.filterLabel;var t=document.createElement("input");t.name="option-select-filter",t.id=`input-${this.filterLabel}`,t.classList=["autofilter-option-select__filter-input govuk-input"],t.type="text",t.setAttribute("aria-describedby",`checkboxes-${this.filterLabel}-count`),t.setAttribute("aria-controls",`checkboxes-${this.filterLabel}-count`),o.appendChild(e),o.appendChild(t);var l=o.cloneNode(!0);l.classList.add("autofilter-option-select__filter"),this.$optionsContainer.parentNode.insertBefore(l,this.$optionsContainer),this.$filter=this.$optionSelect.querySelector('input[name="option-select-filter"]'),this.$filterCount=document.getElementById(this.$filter.getAttribute("aria-describedby")),this.filterTextSingle=" "+this.$filterCount.getAttribute("data-single"),this.filterTextMultiple=" "+this.$filterCount.getAttribute("data-multiple"),this.filterTextSelected=" "+this.$filterCount.getAttribute("data-selected"),this.checkboxLabels=[],this.filterTimeout=0,this.getAllCheckedCheckboxes();for(var i=0;i<this.$allCheckboxes.length;i++)this.checkboxLabels.push(this.cleanString(this.$allCheckboxes[i].textContent));this.$filter.addEventListener("keyup",this.typeFilterText.bind(this))}this.$optionsContainer.querySelector(".autofilter-checkboxes__list").addEventListener("change",this.updateCheckedCount.bind(this));var c=this.checkedString();c&&this.attachCheckedCounter(c)},n.prototype.typeFilterText=function(o){o.stopPropagation();var e=13;o.keyCode!==e?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){this.doFilter(this)}).bind(this),300)):o.preventDefault()},n.prototype.cleanString=function(e){return e=e.replace(/&/g,"and"),e=e.replace(/[’',:–-]/g,""),e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e.trim().replace(/\s\s+/g," ").toLowerCase()},n.prototype.getAllCheckedCheckboxes=function(){this.checkedCheckboxes=[];for(var e=0;e<this.$options.length;e++)this.$options[e].checked&&this.checkedCheckboxes.push(e)},n.prototype.doFilter=function(e){var t=e.cleanString(e.$filter.value),l=e.checkedCheckboxes.slice(),i=0;for(i=0;i<e.$allCheckboxes.length;i++)l.indexOf(i)===-1&&e.checkboxLabels[i].search(t)!==-1&&l.push(i);for(i=0;i<e.$allCheckboxes.length;i++)e.$allCheckboxes[i].style.display="none";for(i=0;i<l.length;i++)e.$allCheckboxes[l[i]].style.display="block";var c=e.$optionsContainer.querySelectorAll(".govuk-checkboxes__input:checked").length,r=l.length+c,h=r+(r===1?e.filterTextSingle:e.filterTextMultiple)+", "+c+e.filterTextSelected;e.$filterCount.textContent=h},n.prototype.attachCheckedCounter=function(e){var t=document.createElement("div");t.setAttribute("class","autofilter-option-select__selected-counter js-selected-counter"),t.textContent=e,this.$optionSelect.querySelector(".autofilter-legend").insertAdjacentElement("afterend",t)},n.prototype.updateCheckedCount=function(){var e=this.checkedString(),t=this.$optionSelect.querySelector(".js-selected-counter");e?t===null?this.attachCheckedCounter(e):t.textContent=e:t&&t.parentNode.removeChild(t)},n.prototype.checkedString=function(){this.getAllCheckedCheckboxes();var e=this.checkedCheckboxes.length,t=!1;return e>0&&(t=e+" selected"),t},s.OptionSelect=n})(window.GOVUK.Modules);var a=new window.GOVUK.Modules.OptionSelect(document.getElementById("autofilter"));a.init();
